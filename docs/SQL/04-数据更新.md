# 数据更新

## 数据的插入

### 什么是 INSERT

通过 `CREATE TABLE` 语句创建出来的表，可以被认为是一个空空如也的箱子。只有把数据装入到这个箱子后，它才能称为数据库。用来装入数据的 SQL 就是 `INSERT`（插入）。

### INSERT 语句的就基本语法

```sql
INSERT INTO <表名> （列 1, 列 2, 列 3, ……) VALUES （值 1, 值 2, 值 3, ……);

-- example
INSERT INTO ProductIns (product_id, product_name, product_type, sale_price, purchase_price, regist_date) VALUES ('0001', 'T 恤衫', '衣服', 1000, 500, '2009-09-20');
```

将列名和值用逗号隔开，分别括在 `（）`内，这种形式称为**清单**。

```sql
-- 列清单
(product_id, product_name, product_type, sale_price, purchase_price, regist_date)

-- 值清单
('0001', 'T 恤衫', '衣服', 1000, 500,'2009-09-20')
```

> 当然，表名后面的列清单和 `VALUES` 子句中的值清单的列数必须保持一致。

- **多行 INSERT**

原则上，执行一次 `INSERT` 语句会插入一行数据。因此，插入多行时，通常需要循环执行相应次数的 INSERT 语句。虽然在大多数情况下该原则都是正确的，但它也仅仅是原则而已，其实很多 RDBMS 都支持一次插入多行数据，这样的功能称为**多行 INSERT**（multi row INSERT）。

```sql
-- 多行 INSERT （Oracle 以外）
INSERT INTO ProductIns VALUES ('0002', '打孔器', '办公用品', 500, 320, '2009-09-11'),
('0003', '运动 T 恤', '衣服', 4000, 2800, NULL),
('0004', '菜刀', '厨房用具', 3000, 2800, '2009-09-20');

-- Oracle 中的多行 INSERT
INSERT ALL INTO ProductIns VALUES ('0002', '打孔器', '办公用品', 500, 320, '2009-09-11')
           INTO ProductIns VALUES ('0003', '运动 T 恤', '衣服', 4000, 2800, NULL)
           INTO ProductIns VALUES ('0004', '菜刀', '厨房用具', 3000, 2800, '2009-09-20')
SELECT * FROM DUAL;
```

使用该语法时请注意以下几点。

首先，`INSERT` 语句的书写内容及插入的数据是否正确。若不正确会发生 `INSERT` 错误，但是由于是多行插入，和特定的单一行插入相比，想要找出到底是哪行哪个地方出错了，就变得十分困难。

其次，多行 `INSERT` 的语法并不适用于所有的 RDBMS。该语法适用于 DB2、SQL、SQL Server、PostgreSQL 和 MySQL，但不适用于 Oracle。

### 列清单的省略

对表进行全列 `INSERT` 时，可以省略表名后的列清单。这时 `VALUES` 子句的值会默认按照从左到右的顺序赋给每一列。

```sql
-- 包含列清单
INSERT INTO ProductIns (product_id, product_name, product_type, sale_price, purchase_price, regist_date) VALUES ('0005', '高压锅', '厨房用具', 6800, 5000, '2009-01-15');

-- 省略列清单
INSERT INTO ProductIns VALUES ('0005', '高压锅', '厨房用具', 6800, 5000, '2009-01-15');
```

### 插入 NULL

`INSERT` 语句中想给某一列赋予 `NULL` 值时，可以直接在 `VALUES` 子句的值清单中写入 `NULL`。

但是，想要插入 `NULL` 的列一定不能设置 `NOT NULL` 约束。向设置了 `NOT NULL` 约束的列中插入 `NULL` 时，`INSERT` 语句会出错，导致数据插入失败（通过 `INSERT` 语句插入的数据无法正常插入到表中，但之前已经插入的数据并不会被破坏）。

> 不仅是 `INSERT`，`DELETE` 和 `UPDATE` 等更新语句也一样，SQL 语句执行失败时都不会对表中数据造成影响。

### 插入默认值

我们还可以向表中插入**默认值**（初始值）。可以通过在创建表的 `CREATE TABLE` 语句中设置 `DEFAULT` 约束来设定默认值。

```sql
sale_price      INTEGER      DEFAULT 0,
```

如果在创建表的同时设定了默认值，就可以在 `INSERT` 语句中自动为列赋值了。默认值的使用方法通常有显式和隐式两种。

- **通过显式方法插入默认值**

在 `VALUES` 子句中指定 `DEFAULT` 关键字。

-- **通过隐式方法插入默认值**

插入默认值时也可以不使用 `DEFAULT` 关键字，只要在列清单和 `VALUES` 中省略设定了默认值的列就可以了。

```sql
INSERT INTO ProductIns (product_id, product_name, product_type, purchase_price, regist_date) VALUES ('0007', '擦菜板', '厨房用具', 790, '2009-04-28');
```

如果省略了没有设定默认值的列，该列的值就会被设定为 `NULL`。因此，如果省略的是设置了 `NOT NULL` 约束的列，INSERT 语句就会出错。

```sql
-- 省略 purchase_price 列（无约束）：会赋予“NULL”
INSERT INTO ProductIns (product_id, product_name, product_type, sale_price, regist_date) VALUES ('0008', '圆珠笔', '办公用品', 100, '2009-11-11');
/*
 product_id | product_name | product_type | sale_price | purchase_price | regist_date
 ------------+--------------+--------------+------------+----------------+-------------
 0008       | 圆珠笔       | 办公用品     |        100 |                | 2009-11-11
*/

-- 省略 product_name 列（设置了 NOT NULL 约束）：错误！
INSERT INTO ProductIns (product_id, product_type, sale_price,purchase_price, regist_date) VALUES ('0009', '办公用品', 1000, 500, '2009-12-12');
/*
错误：null value in column "product_name" of relation "productins" violates not-null constraint
描述：失败，行包含 (0009, null, 办公用品，1000, 500, 2009-12-12).
*/
```

### 从其他表中复制数据

```sql
-- 将商品表中的数据复制到商品复制表中
INSERT INTO ProductCopy (product_id, product_name, product_type, sale_price, purchase_price, regist_date)
SELECT product_id, product_name, product_type, sale_price, purchase_price, regist_date
  FROM Product;
```

执行该 `INSERT … SELECT` 语句时，如果原来 Product 表中有 8 行数据，那么 ProductCopy 表中也会插入完全相同的 8 行数据。当然，Product 表中的原有数据不会发生改变。因此，`INSERT … SELECT` 语句可以在需要进行数据备份时使用。

```sql
-- 根据商品种类进行汇总的表；
CREATE TABLE ProductType
(product_type       VARCHAR(32)     NOT NULL,
 sum_sale_price     INTEGER         ,
 sum_purchase_price INTEGER         ,
 PRIMARY KEY (product_type));

INSERT INTO ProductType (product_type, sum_sale_price, sum_purchase_price)
SELECT product_type, SUM(sale_price), SUM(purchase_price)
  FROM Product
 GROUP BY product_type;

-- 确认插入的数据行
SELECT * FROM ProductType;

/*
 product_type | sum_sale_price  | sum_purchase_price
--------------+-----------------+--------------------
 衣服         |            5000 |               3300
 办公用品     |             600 |                320
 厨房用具     |           11180 |               8590
*/
```

`INSERT` 语句的 `SELECT` 语句中，可以使用 `WHERE` 子句等任何 SQL 语法（但使用 `ORDER BY` 子句并不会产生任何效果）。

> 但即使指定了 `ORDER BY` 子句也没有任何意义，因为无法保证表内部记录的排列顺序。

## 数据的删除

### DROP TABLE 语句和 DELETE 语句

### DELETE 语句的基本语法

### 指定删除对象的 DELETE 语句

## 数据的更新

### UPDATE 语句的基本语法

### 指定条件的 UPDATE 语句

### 使用 NULL 进行更新

### 多列更新

## 事务

### 什么是事务

### 创建事务

### ACID 特性
