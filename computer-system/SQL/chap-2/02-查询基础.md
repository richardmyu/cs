# 查询基础

[TOC]

## 1.SELECT 语句基础

### 1.1.列的查询

从表中选取数据时需要使用 **`SELECT`** 语句，也就是只从表中选出（SELECT）必要数据的意思。通过 `SELECT` 语句查询并选取出必要数据的过程称为 **匹配查询** 或 **查询**（query）。

```sql
SELECT <列名>,...
FROM <表名>;
```

该 `SELECT` 语句包含了 `SELECT` 和 `FROM` 两个 **子句**（clause）。子句是 SQL 语句的组成要素，是以 `SELECT` 或者 `FROM` 等作为起始的短语。

查询出的列的顺序可以任意指定。查询多列时，需要使用逗号进行分隔。查询结果中列的顺序和 `SELECT` 子句中的顺序相同。

### 1.2.查出所有列

想要查询出全部列时，可以使用代表所有列的星号（`*`）。

```sql
SELECT *
FROM <表名>;
```

> **注意**：如果使用星号的话，就无法设定列的显示顺序了。这时就会按照 `CREATE TABLE` 语句的定义对列进行排序。

### 1.3.为列设置别名

SQL 语句可以使用 `AS` 关键字为列设定别名。

```sql
SELECT product_id AS id,
       product_name AS name,
       product_type AS type
FROM product;
```

> **注意**：别名可以使用中文，使用中文时需要用双引号（`"`）括起来。

### 1.4.常数查询

`SELECT` 子句中不仅可以书写列名，还可以书写常数。在 SQL 语句中使用字符串或者日期常数时，必须使用单引号 (`'`) 将其括起来。

```sql
SELECT '商品' AS string, 38 AS number, '2009-02-24' AS date,
 product_id, product_name
 FROM Product;
```

### 1.5.从结果中删除重复行

通过在 `SELECT` 子句中使用 **`DISTINCT`** 来实现删除重复行。

```sql
SELECT DISTINCT product_type
FROM product;
```

在使用 `DISTINCT` 时，`NULL` 也被视为一类数据。`NULL` 存在于多行中时，也会被合并为一条 `NULL` 数据。

在多列之前可以使用 `DISTINCT`，会将多个列的数据进行组合，将重复的数
据合并为一条。但 `DISTINCT` 关键字只能用在第一个列名之前。

### 1.6.根据 `WHERE` 语句来选择记录

`SELECT` 语句通过 **`WHERE`** 子句来指定查询数据的条件。在 `WHERE` 子句中可以指定“某一列的值和这个字符串相等”或者“某一列的值大于这个数字”等条件。执行含有这些条件的 `SELECT` 语句，就可以查询出只符合该条件的记录了。

首先通过 `WHERE` 子句查询出符合指定条件的记录，然后再选取出 `SELECT` 语句指定的列。

```sql
SELECT <列名>,...
FROM <表名>
WHERE <条件表达式>;
```

> `WHERE` 子句必须紧跟在 `FROM` 子句之后，书写顺序发生改变的话会造成执行错误。

### 1.7.注释的书写方法

```sql
-- 这是单行注释

/*
这是
多行
注释
*/
```

> MySQL 中需要在 `--` 之后加入半角空格（如果不加的话就不会被认为是注释）。

## 2.算术运算符和比较运算符

### 2.1.算数运算符

SQL 语句中可以使用计算表达式。（运算是以行为单位执行的。)

| 含意     | 运算符 |
| -------- | :----: |
| 加法运算 |  `+`   |
| 减法运算 |  `-`   |
| 乘法运算 |  `*`   |
| 除法运算 |  `/`   |

```sql
SELECT product_name, sale_price,
       sale_price * 2 AS "sale_price_x2"
FROM product;
```

四则运算所使用的运算符称为 **算术运算符**。运算符就是使用其两边的值进行四则运算或者字符串拼接、数值大小比较等运算，并返回结果的符号。SQL 中也可以使用括号 `()`。括号中运算表达式的优先级会得到提升，优先进行运算。

### 2.2.需要注意 NULL

实际上所有包含 `NULL` 的计算，结果肯定是 `NULL`。

通常情况下，类似 `5/0` 这样除数为 0 的话会发生错误，只有 `NULL` 除以 0 时不会发生错误，并且结果还是 `NULL`。

### 2.3.比较运算符

在 `WHERE` 子句中通过使用 **比较运算符** 可以组合出各种各样的条件表达式。除此之外，还可以使用比较运算符对计算结果进行比较。

| 含义     | 运算符 |
| -------- | :----: |
| 相等     |  `=`   |
| 不相等   |  `<>`  |
| 大于等于 |  `>=`  |
| 大于     |  `>`   |
| 小于等于 |  `<=`  |
| 小于     |  `<`   |

这些比较运算符可以对字符、数字和日期等几乎所有数据类型的列和值进行比较。

> **注意**：在对字符串类型（对定长字符串和可变长字符串都适用）的数据进行大小比较时，使用的是和数字比较不同的规则，典型的规则就是按照字典顺序进行比较。

### 2.4.不能对 NULL 使用比较运算符

即使使用 `<>` 运算符也还是无法选取出 `NULL` 的记录。SQL 提供了专门用来判断是否为 `NULL` 的 `IS NULL` 运算符。反之，希望选取不是 `NULL` 的记录时，需要使用 `IS NOT NULL` 运算符。

## 3.逻辑运算符

### 3.1.NOT 运算符

想要指定“不是”这样的否定条件时，需要使用 `<>` 运算符。除此之外还存在另外一个表示否定，并且使用范围更广的运算符 `NOT`。

`NOT` 不能单独使用，必须和其他查询条件组合起来使用。

### 3.2.AND 运算符和 OR 运算符

在 `WHERE` 子句中使用 `AND` 运算符或者 `OR` 运算符，可以对多个查询条件进行组合。

- `AND` 运算符在其两侧的查询条件都成立时整个查询条件才成立，其意思相当于“并且”。
>
- `OR` 运算符在其两侧的查询条件（至少）有一个成立时整个查询条件都成立，其意思相当于“或者”。

> `AND` 运算符优先于 `OR` 运算符。

### 3.3.使用括号强化处理

括号可以提高运算的优先级。

### 3.4.逻辑运算符和真值

运算符 `NOT`、`AND` 和 `OR` 称为 **逻辑运算符**。这里所说的逻辑就是对真值进行操作的意思。真值就是值为真（TRUE）或假（FALSE）其中之一的值 。

`AND` 运算的结果与乘法运算（积），`OR` 运算的结果与加法运算（和）的结果却是一样的，`AND` 运算符进行的逻辑运算称为 **逻辑积**，使用 `OR` 运算符进行的逻辑运算称为 **逻辑和**。

### 3.5.含有 NULL 时的真值

除真假之外的第三种值 —— **不确定**（UNKNOWN）。一般的逻辑运算并不存在这第三种值。SQL 之外的语言也基本上只使用真和假这两种真值。与通常的逻辑运算被称为 **二值逻辑** 相对，只有 SQL 中的逻辑运算被称为 **三值逻辑**。

- **AND**

|   P    |   Q    | P AND Q |
| :----: | :----: | :-----: |
|   真   |   真   |   真    |
|   真   |   假   |   假    |
|   真   | 不确定 | 不确定  |
|   假   |   真   |   假    |
|   假   |   假   |   假    |
|   假   | 不确定 |   假    |
| 不确定 |   真   | 不确定  |
| 不确定 |   假   |   假    |
| 不确定 | 不确定 | 不确定  |

- **OR**

|   P    |   Q    | P AND Q |
| :----: | :----: | :-----: |
|   真   |   真   |   真    |
|   真   |   假   |   真    |
|   真   | 不确定 |   真    |
|   假   |   真   |   真    |
|   假   |   假   |   假    |
|   假   | 不确定 | 不确定  |
| 不确定 |   真   |   真    |
| 不确定 |   假   | 不确定  |
| 不确定 | 不确定 | 不确定  |

> 原本只有 4 行的真值表，如果要考虑 `NULL` 的话会变得更加繁琐，考虑 `NULL` 时的条件判断也会变得异常复杂。因此，数据库领域的有识之士们达成了“尽量不使用 `NULL`”的共识。创建表时要给某些列设置 `NOT NULL` 约束（禁止录入 `NULL`）的缘故。
