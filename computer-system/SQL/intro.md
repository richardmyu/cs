# SQL

> 基本以 PostgreSQL 和 mySQL 语法为主。

## 2.基础查询

### 2.1.`SELECT` 语句基础

1. 使用 `SELECT` 语句从表中选取数据。
>
2. 为列设定显示用的别名。
>
3. `SELECT` 语句中可以使用常数或者表达式。
>
4. 通过指定 `DISTINCT` 可以删除重复的行。
>
5. SQL 语句中可以使用注释。
>
6. 可以通过 `WHERE` 语句从表中选取出符合查询条件的数据。

### 2.2.算术运算符和比较运算符

1. 运算符就是对其两边的列或者值进行运算（计算或者比较大小等）的符号。
>
2. 使用算术运算符可以进行四则运算。
>
3. 括号可以提升运算的优先顺序（优先进行运算）。
>
4. 包含 `NULL` 的运算，其结果也是 `NULL`。
>
5. 比较运算符可以用来判断列或者值是否相等，还可以用来比较大小。
>
6. 判断是否为 `NULL`，需要使用 `IS NULL` 或者 `IS NOT NULL` 运算符。

### 2.3.逻辑运算符

1. 通过使用逻辑运算符，可以将多个查询条件进行组合。
>
2. 通过 `NOT` 运算符可以生成“不是~”这样的查询条件。
>
3. 两边条件都成立时，使用 `AND` 运算符的查询条件才成立。
>
4. 只要两边的条件中有一个成立，使用 `OR` 运算符的查询条件就可以成立。
>
5. 值可以归结为真（`TRUE`）和假（`FALSE`）其中之一的值称为真值。比较运算符在比较成立时返回真，不成立时返回假。但是，在 SQL 中还存在另外一个特定的真值——不确定（`UNKNOWN`）。
>
6. 将根据逻辑运算符对真值进行的操作及其结果汇总成的表称为真值表。
>
7. SQL 中的逻辑运算是包含对真、假和不确定进行运算的三值逻辑。

## 3.聚合与排序

### 3.1.对表进行聚合查询

1. 使用聚合函数对表中的列进行计算合计值或者平均值等的汇总操作。
>
2. 通常，聚合函数会对 `NULL` 以外的对象进行汇总。但是只有 `COUNT` 函数例外，使用 `COUNT(*)` 可以查出包含 `NULL` 在内的全部数据的行数。
>
3. 使用 `DISTINCT` 关键字删除重复值。

### 3.2.对表进行分组

1. 使用 `GROUP BY` 子句可以像切蛋糕那样将表分割。通过使用聚合函数和 `GROUP BY` 子句，可以根据“商品种类”或者“登记日期”等将表分割后再进行汇总。
>
2. 聚合键中包含 `NULL` 时，在结果中会以“不确定”行（空行）的形式表现出来。
>
3. 使用聚合函数和 `GROUP BY` 子句时需要注意以下 4 点。
  >
  - ① 只能写在 `SELECT` 子句之中
  - ② `GROUP BY` 子句中不能使用 `SELECT` 子句中列的别名
  - ③ `GROUP BY` 子句的聚合结果是无序的
  - ④ `WHERE` 子句中不能使用聚合函数

### 3.3.为聚合结果指定条件

1. 使用 `COUNT` 函数等对表中数据进行汇总操作时，为其指定条件的不是 `WHERE` 子句，而是 `HAVING` 子句。
>
2. 聚合函数可以在 `SELECT` 子句、`HAVING` 子句和 `ORDER BY` 子句中使用。
>
3. `HAVING` 子句要写在 `GROUP BY` 子句之后。
>
4. `WHERE` 子句用来指定数据行的条件，`HAVING` 子句用来指定分组的条件。

### 3.4.对查询结果进行排序

1. 使用 `ORDER BY` 子句对查询结果进行排序。
>
2. 在 `ORDER BY` 子句中列名的后面使用关键字 `ASC` 可以进行升序排序，使用 `DESC` 关键字可以进行降序排序。
>
3. `ORDER BY` 子句中可以指定多个排序键。
>
4. 排序健中包含 `NULL` 时，会在开头或末尾进行汇总。
>
5. `ORDER BY` 子句中可以使用 `SELECT` 子句中定义的列的别名。
>
6. `ORDER BY` 子句中可以使用 `SELECT` 子句中未出现的列或者聚合函数。
>
7. `ORDER BY` 子句中不能使用列的编号。

## 4.数据更新

### 4.1.数据的插入

1. 使用 `INSERT` 语句可以向表中插入数据（行）。原则上，`INSERT` 语句每次执行一行数据的插入。
>
1. 将列名和值用逗号隔开，分别括在 `()` 内，这种形式称为清单。
>
3. 对表中所有列进行 `INSERT` 操作时可以省略表名后的列清单。
>
4. 插入 `NULL` 时需要在 `VALUES` 子句的值清单中写入 `NULL`。
>
5. 可以为表中的列设定默认值（初始值），默认值可以通过在 `CREATE TABLE` 语句中为列设置 `DEFAULT` 约束来设定。
>
6. 插入默认值可以通过两种方式实现，即在 `INSERT` 语句的 `VALUES` 子句中指定 `DEFAULT` 关键字（显式方法），或省略列清单（隐式方法）。
>
7. 使用 `INSERT…SELECT` 可以从其他表中复制数据。

### 4.2.数据的删除

1. 如果想将整个表全部删除，可以使用 `DROP TABLE` 语句，如果只想删除表中全部数据，需使用 `DELETE` 语句。
>
2. 如果想删除部分数据行，只需在 `WHERE` 子句中书写对象数据的条件即可。通过 `WHERE` 子句指定删除对象的 `DELETE` 语句称为搜索型 `DELETE` 语句。

### 4.3.数据的更新

1. 使用 `UPDATE` 语句可以更改（更新）表中的数据。
>
2. 更新部分数据行时可以使用WHERE来指定更新对象的条件。通过WHERE子句指定更新对象的 `UPDATE` 语句称为搜索型 `UPDATE` 语句。
>
3. `UPDATE` 语句可以将列的值更新为 `NULL`。
>
4. 同时更新多列时，可以在 `UPDATE` 语句的 `SET` 子句中，使用逗号分隔更新对象的多个列。

### 4.4.事务

1. 事务是需要在同一个处理单元中执行的一系列更新处理的集合。通过使用事务，可以对数据库中的数据更新处理的提交和取消进行管理。
>
2. 事务处理的终止指令包括 `COMMIT`（提交处理）和 `ROLLBACK`（取消处理）两种。
>
3. DBMS 的事务具有原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability）四种特性。通常将这四种特性的首字母结合起来，统称为 ACID 特性。

## 5.复杂查询

### 5.1.视图

1. 从 SQL 的角度来看，视图和表是相同的，两者的区别在于表中保存的是实际的数据，而视图中保存的是 `SELECT` 语句（视图本身并不存储据）。
>
2. 使用视图，可以轻松完成跨多表查询数据等复杂操作。
>
3. 可以将常用的 `SELECT` 语句做成视图来使用。
>
4. 创建视图需要使用 `CREATE VIEW` 语句。
>
5. 视图包含“不能使用 `ORDER BY`”和“可对其进行有限制的更新”两项限制。
>
6. 删除视图需要使用 `DROP VIEW` 语句。

### 5.2.子查询

1. 一言以蔽之，子查询就是一次性视图（`SELECT` 语句）。与视图不同，子查询在 `SELECT` 语句执行完毕之后就会消失。
>
2. 由于子查询需要命名，因此需要根据处理内容来指定恰当的名称。
>
3. 标量子查询就是只能返回一行一列的子查询。

### 5.3.关联子查询

1. 关联子查询会在细分的组内进行比较时使用。
>
2. 关联子查询和 `GROUP BY` 子句一样，也可以对表中的数据进行切分。
>
3. 关联子查询的结合条件如果未出现在子查询之中就会发生错误。

## 6.函数、谓词、`CASE` 表达式

### 6.1.函数

1. 根据用途，函数可以大致分为算术函数、字符串函数、日期函数、转换函聚合函数。
>
2. 函数的种类很多，无需全都记住，只需要记住具有代表性的函数就可以了，其他的可以在使用时再进行查询。

### 6.2.谓词

1. 谓词就是返回值为真值的函数。
>
2. 掌握 `LIKE` 的三种使用方法（前方一致、中间一致、后方一致）。
>
3. 需要注意 `BETWEEN` 包含三个参数。
>
4. 想要取得 `NULL` 数据时必须使用 `IS NULL`。
>
5. 可以将子查询作为 `IN` 和 `EXISTS` 的参数。

### 6.3.`CASE` 表达式

1. `CASE` 表达式分为简单 `CASE` 表达式和搜索 `CASE` 表达式两种。搜索 `CASE` 表达式包含简单 `CASE` 表达式的全部功能。
>
2. 虽然 `CASE` 表达式中的 `ELSE` 子句可以省略，但为了让 SQL 语句更加容易理解，还是希望大家不要省略。
>
3. `CASE` 表达式中的 `END` 不能省略。
>
4. 使用 `CASE` 表达式能够将 `SELECT` 语句的结果进行组合。
>
5. 虽然有些 DBMS 提供了各自特有的 `CASE` 表达式的简化函数，例如 Oracle 中的 `DECODE` 和 MySQL 中的 `IF`，等等，但由于它们并非通用的函数，功能上也有些限制，因此有些场合无法使用。

## 7.集合运算

### 7.1.表的加减法

1. 集合运算就是对满足同一规则的记录进行的加减等四则运算。
>
2. 使用 `UNION`（并集）、`INTERSECT`（交集）、`EXCEPT`（差集）等集合运算符来进行集合运算。
>
3. 集合运算符可以去除重复行。
>
4. 如果希望集合运算符保留重复行，就需要使用 `ALL` 选项。

### 7.2.联结（以列为单位对表进行联结）

1. 联结（JOIN）就是将其他表中的列添加过来，进行“添加列”的集合运算。`UNION` 是以行（纵向）为单位进行操作，而联结则是以列（横向）为单位进行的。
>
2. 联结大体上分为内联结和外联结两种。首先请大家牢牢掌握这两种联结的使用方法。
>
3. 请大家一定要使用标准 SQL 的语法格式来写联结运算，对于那些过时的或者特定 SQL 中的写法，了解一下即可，不建议使用。

---

必读

- [x] 1.《SQL基础教程》(第二版) MICK --（PostgreSQL 向）
- [ ] 2.《MySQL必知必会》Ben Forta
- [ ] 3.[SQL 教程](https://www.runoob.com/sql/sql-tutorial.html) --（MySQL 向）
- [ ] 4.[sqlbolt](https://sqlbolt.com/)

参考：

1.[PostgreSQL 教程](https://www.runoob.com/postgresql/postgresql-tutorial.html)
2.[PostgreSQL 13.1 手册](http://www.postgres.cn/docs/13/index.html)
3.[PostgreSQL(数据库)资料](https://github.com/ty4z2008/Qix/blob/master/pg.md)
