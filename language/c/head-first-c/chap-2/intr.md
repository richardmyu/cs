# 存储器和指针

- **指针**

指针是理解 C 语言最基本的要素之一。**指针** 就是存储器中某条数据的地址。

使用指针的原因（**避免副本 共享数据**）：

1. 在函数调用时，可以只传递一个指针，而不用传递整份数据；
>
2. 让两段代码处理同一条数据，而不是处理两份独立的副本；

每当声明一个变量，计算机都会在存储器中某个地方为它创建空间。如果在函数中声明变量，会保存在一个叫 **栈**（Stack）的存储器区段中；如果在函数以外的地方声明变量，则会保存在存储器的 **全局量段**（Globals）。

- **传参**

C 语言是按值传递参数的。

- **使用存储器指针**

1. 得到变量的地址

使用 `&` 运算符找到变量保存在存储器中的位置。一旦得到了变量的地址，就需要把它保存在某个地方。为此，需要指针变量。指针变量是一个用来保存存储器地址的变量。当声明指针变量时，需要说明指针所指向的地址中保存的数据的类型：

```c
int *address_of_x = &x;
```

2. 读取地址中的内容

可以使用 `*` 运算符，与`&` 运算符恰好相反。`&` 运算符接收一个数据，返回地址；`*` 运算符就收一个地址，返回数据内容。因为指针有时也叫 **引用**，所有 `&` 运算符也可以描述成对指针进行 **解引用**。

```c
int value_stored = *address_of_x;
```

3. 改变地址中的内容

还是使用 `*` 运算符。

```c
*address_of_x = 99;
```

## questions

- **为什么局部变量保存在栈中，而全局变量保存在其它地方**

因为局部变量和全局变量的用法不同。永远只能的得到一份全局变量，但如果写了一个调用自己的函数，就会得到同一个局部变量的很多个实例。

- **指针是真实的地址单元，还是某种形式的引用**

它们是进程存储器中真实编号的地址。

- **为什么存储器是进程的**

计算机会为每个进程分配一个简版存储器，看起来就像是一长串字节。实际的存储器复杂多了，但细节对进程隐藏了起来，这样操作系统就可以在存储器中移动进程，或释放并重新加载到其它位置。物理储存器的结构十分复杂，计算机通常会将存储器地址分组映射到存储芯片的不同的存储体（memory bank）。

- **为什么一定要用 `%p` 格式串来打印指针**

不一定，大大多数的现代计算机上可以用 `%li`，但编译器可能会给出一条警告。

> gcc version 8.1.0 (x86_64-win32-seh-rev0, Built by MinGW-W64 project) 实测不会警报。

- **为什么 `%p` 以十六进制显示存储器地址**

工程师通常以十六进制表示存储器地址。

- **如果我们把读取存储器单元的内容称为”解引用“，那么指针是不是应该叫”引用“**

人们有时会把指针叫做”引用“，因为它引用了存储器中的某个地址单元。但 C++ 程序员通常用”引用“表示 C++ 中一个稍有不同的概念。
